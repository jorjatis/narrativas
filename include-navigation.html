<style>html{scroll-behavior:smooth}body{position:relative;background:#161515}body::before{content:"";position:absolute;inset:0 auto 0 50%;transform:translateX(-50%);width:1px;height:100%;background:hsla(0,0%,100%,.2);z-index:0}.voc-header .voc-header__text{color:#575757}.voc-header .voc-progress{background:#575757}body .voc-footer{margin:180px auto 0}body .voc-footer .voc-heading__logo{filter:invert(1)}body .voc-footer .voc-footer__corporate .voc-heading__logo{filter:brightness(5)}body .voc-footer .voc-heading__text,body .voc-footer .voc-to-top__text,body .voc-footer .voc-footer-nav__list li a,body .voc-footer .voc-footer-nav__list li:after{color:hsla(0,0%,100%,.8)}body .voc-footer .voc-to-top__icon rect{fill:var(--cb1)}body .voc-footer .voc-to-top__icon path{fill:#fff}.voc-wrapper>.voc-container--wxs:first-child{max-width:745px}.voc-wrapper>.voc-container--wxs:nth-child(2){max-width:588px}.voc-container .voc-article--detail-visual .voc-info-container{padding:80px 0 0}.voc-container .voc-article--detail-visual .voc-info-container .voc-pretitle-sponsor-link{margin-bottom:30px;width:169px;height:auto}.voc-container .voc-article--detail-visual .voc-info-container .voc-pretitle-sponsor-link img{margin-bottom:0}.voc-container .voc-article--detail-visual .voc-info-container .voc-title{width:100%;max-width:100%;margin:0;font:50px/48px "ABCDisplay Extralight",Georgia,Times New Roman,serif;text-transform:uppercase;color:#f9f6ee;letter-spacing:-2.7px}@media(min-width: 1366px){.voc-container .voc-article--detail-visual .voc-info-container .voc-title{font-size:90px;line-height:80px}}.voc-container .voc-article--detail-visual .voc-info-container .voc-author{margin-top:160px}.voc-container .voc-article--detail-visual .voc-info-container .voc-author__item--1:before{background:#fff}.voc-container .voc-article--detail-visual .voc-info-container .voc-author__subitem--1{margin:0}.voc-container .voc-article--detail-visual .voc-info-container .voc-author__subitem--1 .voc-author__name{color:#fff}.voc-container .voc-article--detail-visual .voc-img-container{margin-top:72px}@media(min-width: 1366px){.voc-container .voc-article--detail-visual .voc-img-container--wmd{max-width:unset;width:1200px;margin-left:unset}}.voc-container .voc-article--detail-visual video{width:100%;margin-top:0;object-fit:cover;aspect-ratio:7/10}@media(min-width: 699px){.voc-container .voc-article--detail-visual video{aspect-ratio:16/9}}.voc-container .voc-article--detail-visual .voc-subtitle{max-width:600px;margin:80px 0 0;font:22px/28px "ABCText Light",Georgia,Times New Roman,serif;color:hsla(0,0%,100%,.8)}.voc-container .voc-article--detail-visual .voc-author__time{color:hsla(0,0%,100%,.8)}.voc-d--visual.voc-d>*,.voc-d--visual.voc-d span.paywall>*{margin-bottom:32px}.voc-d--visual.voc-d span.paywall .voc-advertising--megabanner,.voc-d--visual.voc-d span.paywall .voc-advertising--native{position:relative;margin-top:60px;margin-bottom:80px;overflow:visible}.voc-d--visual.voc-d span.paywall .voc-advertising--megabanner:before,.voc-d--visual.voc-d span.paywall .voc-advertising--native:before{content:"Publicidad";position:absolute;left:50%;bottom:-20px;transform:translateX(-50%);color:#666;font:10px/1 "Basier Square Regular",Arial,Roboto,Helvetica,sans-serif}.voc-d--visual .voc-author__time{color:#fff}.voc-d--visual .voc-social__icon--save svg{fill:#fff}.voc-d--visual .voc-social__icon--comments{cursor:pointer}.voc-d--visual .voc-social__icon--comments svg{fill:#fff;transition:opacity .3s}.voc-d--visual .voc-social__icon--comments svg:hover{opacity:.7}.voc-d--visual .voc-p{font-size:20px;line-height:28px;color:#fff}.voc-d--visual .voc-c-container .voc-article--c-photo .voc-figcaption-container{margin:10px 0 0 20px}.voc-d--visual .voc-c-container .voc-article--c-photo .voc-figcaption-container:before{top:-44px;left:-10px;height:calc(100% + 42px)}.voc-d--visual .voc-c-container--wmd .voc-article--c-photo .voc-figcaption-container{margin:43px 0 0 30px}.voc-d--visual .voc-c-container--wmd .voc-article--c-photo .voc-figcaption-container:before{top:-86px;left:-20px;height:calc(100% + 84px)}.voc-d--visual .voc-c-container--wsm-max .voc-article--c-photo .voc-figcaption-container{margin:10px 0 0 20px}.voc-d--visual .voc-c-container--wsm-max .voc-article--c-photo .voc-figcaption-container:before{top:-44px;left:-10px;height:calc(100% + 42px)}.voc-d--visual .voc-article--c-photo{margin-top:40px;margin-bottom:40px}.voc-d--visual .voc-figcaption-container{position:relative;font-size:14px;line-height:19px;color:hsla(0,0%,100%,.6980392157)}.voc-d--visual .voc-figcaption-container:before{content:"";position:absolute;width:1px;background:hsla(0,0%,100%,.3019607843)}.voc-d--visual .voc-figcaption-container .voc-figcaption--type{color:hsla(0,0%,100%,.6980392157)}.voc-d--visual .voc-c-container:has(.voc-article--c-summary){margin:0 auto}.voc-d--visual .voc-article--c-summary{max-width:525px;margin:40px auto}.voc-d--visual .voc-article--c-summary .voc-info-container:before{width:185px;height:4px;margin-bottom:12px;background:#fc3636}.voc-d--visual .voc-article--c-summary .voc-title{font-family:"ABCDisplay Semibold",Georgia,Times New Roman,serif;font-size:26px;line-height:28px;color:#fff}.voc-d--visual .voc-c-container .voc-d-c-fignumber__container{left:unset;right:-239px;width:170px}.voc-d--visual .voc-c-container .voc-d-c-fignumber__container:before{content:none}.voc-d--visual .voc-c-container .voc-d-c-fignumber__number{margin-bottom:6px;font-family:"Basier Square Semibold",Arial,Roboto,Helvetica,sans-serif;font-size:50px;line-height:42px;color:#fc3636}.voc-d--visual .voc-c-container .voc-d-c-fignumber__title{margin-bottom:0;font-family:"Basier Square Semibold",Arial,Roboto,Helvetica,sans-serif;font-size:22px;line-height:26px;color:#fff}.voc-d--visual .voc-d-c-combo-3{margin:40px 0}.voc-d--visual .voc-d-c-combo-3 .voc-figcaption-container,.voc-d--visual .voc-d-c-zoom .voc-figcaption-container,.voc-d--visual .v-cmp-jxt .voc-figcaption-container{margin:10px 0 0 20px}.voc-d--visual .voc-d-c-combo-3 .voc-figcaption-container:before,.voc-d--visual .voc-d-c-zoom .voc-figcaption-container:before,.voc-d--visual .v-cmp-jxt .voc-figcaption-container:before{top:-44px;left:-10px;height:calc(100% + 42px)}.voc-d--visual .voc-pill-m.fill path:not([fill^="#fff"]),.voc-d--visual .voc-pill-m.fill circle:not([fill^="#fff"]),.voc-d--visual .voc-pill-m.fill ellipse:not([fill^="#fff"]){fill:var(--cb1)}.voc-c-container .voc-d-c-chapter{position:relative;scroll-margin-top:180px;margin-top:100px;margin-bottom:40px;text-align:center}.voc-c-container .voc-d-c-chapter:before{content:"";position:absolute;top:-30px;left:50%;transform:translateX(-50%);width:170px;height:1px;background:hsla(0,0%,100%,.2)}.voc-c-container .voc-d-c-chapter .voc-d-c__pretitle{max-width:562px;margin:0 auto;font:20px/normal "ABCText Light",Georgia,Times New Roman,serif;color:#fc3636}.voc-c-container .voc-d-c-chapter .voc-d-c__pretitle:before,.voc-c-container .voc-d-c-chapter .voc-d-c__pretitle:after{content:"";position:absolute;top:-36px;left:50%;transform:translateX(-50%);margin:0;border-radius:100%;background:#fc3636}.voc-c-container .voc-d-c-chapter .voc-d-c__pretitle:before{width:12px;height:12px;z-index:1}.voc-c-container .voc-d-c-chapter .voc-d-c__pretitle:after{width:34px;height:34px;margin-top:-11px;margin-left:-17px;transform-origin:center;animation:radar 2s infinite;z-index:0}@keyframes radar{0%{transform:scale(0.2);opacity:1}70%,100%{transform:scale(1.2);opacity:0}}.voc-c-container .voc-d-c-chapter .voc-d-c-chapter__title{max-width:562px;margin:20px auto 0;font:40px/normal "ABCDisplay Semibold",Georgia,Times New Roman,serif;letter-spacing:-1.2px;color:#f9f6ee}.voc-container .v-c-crd{margin:82px auto 0}.voc-container .v-c-crd:before,.voc-container .v-c-crd:after{content:"";display:block;width:267px;height:1px;background:#fff}.voc-container .v-c-crd:before{margin-bottom:20px}.voc-container .v-c-crd:after{margin-top:20px}.voc-container .v-c-crd>span,.voc-container .v-c-crd ul li{color:#fff}.voc-container .v-c-crd li b{margin:0}.voc-container.voc-container--spc{position:sticky;top:67px;left:0;width:100vw;max-width:100vw;margin-left:calc(50% - 50vw);margin-right:unset;margin-bottom:72px;padding:0;background:rgba(22,21,21,.9);z-index:2}.voc-container.voc-container--spc .v-spc-nav{width:986px;transform:translateX(-50%);margin-left:50%;border-top:1px solid #bdbdbd;border-bottom:1px solid #bdbdbd}.voc-container.voc-container--spc .v-spc-nav nav ul{display:flex;justify-content:space-between;align-items:center;gap:12px;height:42px}.voc-container.voc-container--spc .v-spc-nav nav ul li{min-height:24px;display:flex;align-items:center;justify-content:center;padding:0 12px;font:12px/1 "Basier Square Semibold",Arial,Roboto,Helvetica,sans-serif;text-transform:uppercase;text-align:center;color:#fff;background-color:rgba(0,0,0,0);transition:.3s;border-radius:2px}.voc-container.voc-container--spc .v-spc-nav nav ul li:hover{opacity:.7}.voc-container.voc-container--spc .v-spc-nav nav ul li.is-active{background-color:#fc3636}.voc-container.voc-container--spc .v-spc-nav nav ul li.is-active:hover{opacity:1}.v-spc-map-c{display:none}@media(min-width: 1395px){.v-spc-map-c{display:block;position:sticky;top:100px;transform:translateX(-400px);z-index:2}}.v-spc-map{width:350px;height:auto;margin-bottom:24px}@media(min-width: 699px){.v-spc-map{width:420px}}@media(min-width: 1395px){.v-spc-map{position:absolute}}.v-spc-map .textos text{font-size:24px;fill:#fff;text-transform:uppercase}.v-spc-map .textos text:first-child{font-family:"Basier Square Semibold",Arial,Roboto,Helvetica,sans-serif}.v-spc-map .textos text:last-child{font-family:"Basier Square Regular",Arial,Roboto,Helvetica,sans-serif}.v-spc-map .radar{transition:transform 2s ease}.v-spc-map .radar circle:first-child{animation:radarSvg 2s infinite}@keyframes radarSvg{0%{r:0;opacity:1}70%,100%{r:25;opacity:0}}.v-spc-map--1 .radar{transform:translate(7px, 30px)}.v-spc-map--2 .radar{transform:translate(38px, 146px)}.v-spc-map--3 .radar{transform:translate(38px, 149px)}.v-spc-map--4 .radar{transform:translate(56px, 201px)}.v-spc-map--5 .radar{transform:translate(50px, 182px)}.v-spc-map--6 .radar{transform:translate(56px, 201px)}</style>

<div class="voc-container voc-container--spc">
  <div class="v-spc-nav">
    <nav>
      <ul>
        <li class="is-active" data-target="zona-1"><a href="#zona-1">Raquel y Giulia</a></li>
        <li data-target="zona-2"><a href="#zona-2">María José y Jordi</a></li>
        <li data-target="zona-3"><a href="#zona-3">Emilia y Salvador</a></li>
        <li data-target="zona-4"><a href="#zona-4">Begoña</a></li>
        <li data-target="zona-5"><a href="#zona-5">Patricia</a></li>
        <li data-target="zona-6"><a href="#zona-6">Marga y Paco</a></li>
      </ul>
    </nav>
  </div>
</div>

<script>
  const chapters = [...document.querySelectorAll('.voc-d-c-chapter')];

  // Asignar IDs si no los tienen
  chapters.forEach((el, index) => {
    if (!el.id) el.id = `zona-${index + 1}`;
  });


  // Configuración del Intersection Observer
  const observerOptions = {
    root: null,
    rootMargin: '-10% 0px -60% 0px', // Activa cuando la zona está en el tercio superior
    threshold: 0
  };

  let currentZone = 1;

  // Función para actualizar el estado activo
  function updateActiveState(zoneNumber) {
    if (currentZone === zoneNumber) return; // Evitar actualizaciones innecesarias

    currentZone = zoneNumber;

    // Actualizar navegación
    const navItems = document.querySelectorAll('.v-spc-nav li');
    navItems.forEach(item => {
      item.classList.remove('is-active');
      if (item.getAttribute('data-target') === `zona-${zoneNumber}`) {
        item.classList.add('is-active');
      }
    });

    // Actualizar mapa
    const map = document.querySelector('.v-spc-map');
    if (map) {
      // Remover todas las clases de zona anteriores
      map.className = map.className.replace(/v-spc-map--\d+/g, '').trim();
      // Añadir la nueva clase
      map.classList.add(`v-spc-map--${zoneNumber}`);
    }

    console.log(`Zona activa: ${zoneNumber}`);
  }

  // Función para encontrar la zona más cercana al top
  function findClosestZone() {
    const chapters = document.querySelectorAll('[id^="zona-"]');
    let closestZone = null;
    let closestDistance = Infinity;

    chapters.forEach(chapter => {
      const rect = chapter.getBoundingClientRect();
      const zoneNumber = parseInt(chapter.id.split('-')[1]);

      // Calcular distancia desde el top del viewport
      // Si está arriba del viewport, usamos distancia negativa
      const distance = Math.abs(rect.top);

      // Si la zona está visible en el viewport o justo arriba
      if (rect.top <= window.innerHeight * 0.4) {
        if (distance < closestDistance) {
          closestDistance = distance;
          closestZone = zoneNumber;
        }
      }
    });

    return closestZone;
  }

  // Callback del observer - ahora solo activa la búsqueda
  function handleIntersection(entries) {
    // Cuando cualquier zona entra o sale, recalculamos cuál debe estar activa
    const activeZone = findClosestZone();
    if (activeZone) {
      updateActiveState(activeZone);
    }
  }

  // Crear el observer
  const observer = new IntersectionObserver(handleIntersection, observerOptions);

  // También escuchar el scroll para mayor precisión
  let scrollTimeout;
  function handleScroll() {
    clearTimeout(scrollTimeout);
    scrollTimeout = setTimeout(() => {
      const activeZone = findClosestZone();
      if (activeZone) {
        updateActiveState(activeZone);
      }
    }, 50); // Debounce de 50ms
  }

  // Iniciar observer
  function initObserver() {
    const chapters = document.querySelectorAll('[id^="zona-"]');

    if (chapters.length === 0) {
      console.warn('No se encontraron elementos con id "zona-*"');
      return;
    }

    chapters.forEach(chapter => {
      observer.observe(chapter);
    });

    // Añadir listener de scroll
    window.addEventListener('scroll', handleScroll, { passive: true });

    // Establecer estado inicial
    const initialZone = findClosestZone();
    if (initialZone) {
      updateActiveState(initialZone);
    }

    console.log(`Observer iniciado para ${chapters.length} zonas`);
  }

  // Iniciar cuando el DOM esté listo
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initObserver);
  } else {
    initObserver();
  }

  // Scroll suave en navegación
  document.addEventListener('DOMContentLoaded', () => {
    const navLinks = document.querySelectorAll('.v-spc-nav a');

    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
          targetElement.scrollIntoView({
            behavior: 'smooth',
            block: 'start'
          });
        }
      });
    });
  });
</script>